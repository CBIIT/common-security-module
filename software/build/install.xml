<?xml version="1.0" encoding="utf-8" ?>
<!-- bda-build-template version 1.0.1 -->
<!--
$Id: install.xml 1593 2009-04-27 21:29:25Z saksass $
$HeadURL: https://gforge.nci.nih.gov/svnroot/automation/trunk/software/bda-build-template/software/build/install.xml $
-->

<project name="csm-installer" default="install:upt" basedir="." xmlns:ivy="antlib:org.apache.ivy.ant">

	<property name="jboss.grid.configure" value="false"/>
	<property name="tomcat.grid.configure" value="false"/>
	
	<import file="install-cgmmweb.xml"/>
	<import file="install-upt.xml"/>
	<import file="install-backwards-compatible-upt.xml"/>
	
	<target name="install:upt" description="Installs and configures JBOSS, creates database, and deploys application" depends="
		common:jboss:init,
		common:tomcat:init,
		common:init,
		
		install:jboss:init,
		install:common:validation:pre-install,
		install:jboss:validation:pre-install,
		install:tomcat:validation:pre-install,
		install:database:validation:pre-install,
		install:jboss:stop,
		install:tomcat:stop,
		install:jboss:validation:pre-install:ports,
		install:tomcat:validation:pre-install:ports,
		install:common:clean,
		install:database,
		install:tomcat:upt,
		install:jboss:upt,
		install:common:post,
		install:jboss:start,
		install:common:validation:post-install
		">
	</target>

	<target name="install:cgmmweb" description="Installs and configures JBOSS, creates database, and deploys application" depends="
		-install:jboss:cgmmweb
		">
	</target>
	
	<!-- validate database -->
	<target name="upgrade:backwards-compatible-upt" description="Installs and configures JBOSS, creates database, and deploys application" depends="		
		upgrade:jboss:backwards-compatible-upt
		">
	</target>

	
	<target name="install:backwards-compatible-upt" description="Installs and configures JBOSS, creates database, and deploys application" depends="
		install:backwards-compatible-upt:database:validation:pre-install,
		install:jboss:backwards-compatible-upt,
		install:backwards-compatible-upt:databases
		">
	</target>
	
	<target name="upgrade:jboss:readers:bda" if="jboss.exists">
		<properties-exist
			properties.list="application.base.path,jboss.home,jboss.server.name"
			/>
		<osfamily property="os.family"/>
		<if>
			<or>
				<equals arg1="${os.family}" arg2="unix"/>
				<equals arg1="${os.family}" arg2="mac"/>
			</or>
			<then>
				<property name="jboss.server.hostname" value="${env.HOSTNAME}"/>
			</then>
		</if>
		<if>
			<equals arg1="${os.family}" arg2="windows"/>
			<then>
				<property name="jboss.server.hostname" value="${env.COMPUTERNAME}"/>
			</then>
		</if>
		<jboss-read-bindings-file-location
			jboss.home="${read.jboss.home}"
			/>
		<jboss-read-ports
			/>
		<read-property-from-properties-service
			jboss.home="${read.jboss.home}"
			property.name="property1"
			/>
		<read-property-from-properties-service
			jboss.home="${read.jboss.home}"
			property.name="property2"
			/>
	</target>
	
</project>