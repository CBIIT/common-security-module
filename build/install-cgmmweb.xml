<?xml version="1.0" encoding="utf-8" ?>
<!-- bda-build-template version 1.0.1 -->
<!--
$Id: install.xml 1593 2009-04-27 21:29:25Z saksass $
$HeadURL: https://gforge.nci.nih.gov/svnroot/automation/trunk/software/bda-build-template/software/build/install.xml $
-->

<project name="cgmmweb-installer" default="install:jboss:cgmmweb" basedir="." xmlns:ivy="antlib:org.apache.ivy.ant">

	<import file="bda-master-install.xml" />
	<!-- Generic properties -->
	<property name="project.name" value="cgmmweb-installer" />	

	<property name="cgmmweb.dir.dist" value="${basedir}/${cgmmweb.dist.relative.dir}" />
	<property name="cgmm.war.file" value="cgmmweb.war" />
	
	<target name="install:jboss:cgmm-webapp" description="Deploy bda-blueprints-webapp and common libraries to jboss installation" unless="exclude.jboss" depends="common:init">
		<!-- added to ensure working.dirs are fresh for our install -->
		<delete dir="${jboss.home}/server/${jboss.server.name}/tmp" />
		<delete dir="${jboss.home}/server/${jboss.server.name}/work" />
		<move file="${jboss.home}/server/${jboss.server.name}/log/server.log" tofile="${jboss.home}/server/${jboss.server.name}/log/server/log.${install.time}" failonerror="false" />

		<copy file="${cgmmweb.dir.dist}/${cgmm.war.file}" todir="${jboss.home}/server/${jboss.server.name}/deploy" overwrite="true" />
		<!--  Many NCI applications require clm for csm, so you can point this to where you have the version you want to use
		<copy file="${bda-utils.dir}/clm-3.2.jar" todir="${jboss.home}/server/${jboss.server.name}/lib" overwrite="true" />
		-->
		<copy file="${database.driver.file}" todir="${jboss.home}/server/${jboss.server.name}/lib" overwrite="true" />
	</target>

	<!-- Wrapper target to deploy JBOSS container 
		  install:jboss:validation:post-install	-->
	<target name="install:jboss:cgmmweb" description="Wrapper scripts that calls all required targets to install the jboss container" unless="exclude.jboss" depends="
		common:jboss:init,
		common:init,
		install:jboss:init,
		install:jboss:validation:pre-install,
		install:jboss:stop,
		install:jboss:validation:pre-install:ports,
		install:jboss:clean,
		install:jboss:binaries,
		install:jboss:cgmm-webapp:re-configure,
		install:jboss:cgmm-webapp,
		install:jboss:cgmm-webapp:configure,
		install:jboss:configure,
		install:post:jboss,
		install:jboss:start		
		">
	</target>
	
	<!-- install:tomcat:validation:post-install -->
	<target name="install:tomcat:cgmmweb" description="Wrapper scripts that calls all required targets to install the tomcat container" unless="exclude.tomcat" depends="
		common:tomcat:init,
		common:init,
		install:tomcat:validation:pre-install,
		install:tomcat:stop,
		install:tomcat:validation:pre-install:ports,
		install:tomcat:clean,
		install:tomcat:binaries,
		install:tomcat:configure,
		install:tomcat:cgmm-webapp,
		install:tomcat:cgmm-webapp:configure,
		install:tomcat:cgmm-webapp:re-configure,
		install:post:tomcat,
		install:tomcat:start
		">
	</target>

	<target name="install:tomcat:cgmm-webapp" description="Deploy bda-blueprints-webapp and common libraries to jboss installation" unless="exclude.tomcat" depends="common:init">
		<delete dir="${tomcat.home}/temp" />
		<delete dir="${tomcat.home}/work" />
		<copy file="${cgmmweb.dir.dist}/${cgmm.war.file}" todir="${tomcat.home}/webapps" overwrite="true" />
		<copy file="${database.driver.file}" todir="${tomcat.home}/common/lib" overwrite="true" />
	</target>

	<target name="install:jboss:cgmm-webapp:configure">
	</target>
	<target name="install:tomcat:cgmm-webapp:configure">
	</target>

	<target name="install:jboss:cgmm-webapp:re-configure">
	</target>
	<target name="install:tomcat:cgmm-webapp:re-configure">
	</target>
	
</project>
